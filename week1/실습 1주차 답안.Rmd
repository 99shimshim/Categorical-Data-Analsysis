---
title: "실습 1주차"
output: html_document
---

## 0. 실습에 필요한 패키지 불러오기
만약 해당 패키지가 설치되어 있지 않다면, 각주를 제거하여 설치 먼저 해주세요!

```{r}
#install.packages('tidyverse') 
#install.packages('magrittr') 
#install.packages('data.table') 

library(tidyverse)
library(magrittr)
library(data.table)
```

## 1.csv파일을 불러오고 데이터의 형식 파악하기

```{r}
#setwd('데이터가 저장되어 있는 곳으로 설정')
data=fread('titanic.csv') %>% mutate_all(as.factor)

#데이터가 어떻게 구성되어 있는지 확인해봅시다! (실행)
data %>% str()
```

----[변수 설명]----------------------------------------------

$Survived(생존여부) : 0 = 사망 , 1 = 생존
$Pclass(객석 등급) : 1 = 1등석 , 2 = 2등석, 3 = 3등석
$Sex(성별) : male = 남성, female = 여성
$Embarked(탑승지) : C = 셰르부르, Q = 퀸즈타운, S = 사우샘프턴

--------------------------------------------------------------

## 2. 분할표

# **2-1) 데이터 중 두 변수를 골라 2차원 분할표를 만들어보세요** 
     
     Hint ! : table() 함수 사용 

```{r}
#ex)
t_2 <- table(data$Sex, data$Survived)
t_2
```

# **2-2) 만들어진 2차원 분할표를 비율에 대한 분할표로 변환해보세요**
     
     Hint !: prop.table 함수 사용, 소숫점 둘째자리까지
     
```{r}
t_2 %>% prop.table() %>% round(2)
```

# **2-3) 2-1에서 생성한 2차원 분할표를 시각화해보세요**
     
     Hint ! : mosaicplot 함수 사용
     
```{r}
mosaicplot(t_2,color=c('skyblue','pink'))
```

# **2-4) 데이터 중 세 변수를 골라 3차원 분할표를 만들어 보세요**

     Hint !: table, ftable 함수 사용
     (두 함수 모두 사용해보고 어떤 형태적 차이가 있는지 확인해보기)
     
```{r}
#ex)
t_3 <-table(data$Survived, data$Sex, data$Embarked)
t_3 <-ftable(data$Survived, data$Sex, data$Embarked)
t_3
```

## 3. 독립성 검정 

시작하기에 앞서 해당 패키지를 설치 및 불러와주세요!
```{r}
#install.packages('vcd')
#install.packages('DescTools')
#install.packages('vcdExtra')

library(vcd) #assocstats()함수를 위한 패키지
library(DescTools) #GTest() 함수를 위한 패키지
library(vcdExtra) # MHChisqTest(), CMHtest() 함수를 위한 패키지
```

앞선 2-1에서 만든 2차원 분할표를 가지고 독립성 검정을 진행해 봅시다!
각 검정방법을 통하여 검정을 진행하여 해당 결과와 그에 따른 해석도 적어보세요!

# **3-1) 명목형 자료에 대한 독립성 검정을 진행해보기**

     Hint !:  chisq.test() : 피어슨 카이제곱 검정 함수
              GTest() : 가능도비 검정 함수
              assocstats() : 피어슨 카이제곱 검정과 가능도비 검정 한번에 진행 
              
             
```{r}
t_2 %>% chisq.test()
t_2 %>% GTest()
t_2 %>% assocstats()

#해석 : 모든 검정법이 귀무가설을 모두 기각 - 생존여부와 성별 변수 사이에는 상관관계가 존재한다. 
```

# **3-2) 순서형 자료에 대한 독립성 검정을 진행해보기**
이 문제는 순서형 변수로만 구성된 데이터를 따로 불러와 진행해보도록 할게요!

```{r}
#실행
JobSat #vcdExtra 패키지 안에 있는 데이터 셋으로 두개의 순서형 변수로 구성
```
       
     Hint!: CMHtest( ,types='cor')
            MHchisqTest()

```{r}
CMHtest(JobSat,types='cor')
MHChisqTest(JobSat)

#해석 : p-value가 0.05보다 크므로 유의수준 95%라고 가정한다면 귀무가설을 기각할 수 없습니다. 
```

# **3-3) 소표본 자료에 대한 독립성 검정을 진행해보기**
피셔의 정확검정을 이용하여 표본 수가 적은 분할표의 독립성을 검정해보도록 할게요. 
이번에는 임의로 생성한 데이터를 이용하여 진행해 보겠습니다.

```{r}
# 도수가 적은 소표본 분할표 생성
matrix <- matrix(c(2, 28, 5, 25), c(2, 2))
dimnames(matrix) <- list(sex = c("F", "M"), couple = c("O", "X"))
```

     Hint !:  fisher.test() : 피셔의 정확검정 함수

```{r}
# 피셔 검정 
matrix %>% fisher.test()

#해석 : p-value가 0.05보다 크므로 유의수준 95%라고 가정한다면 귀무가설을 기각할 수 없습니다. 즉, 성별과 연인여부는 서로 독립입니다.
```


## 4. 연관성 측도

타이타닉 데이터에서 '성별(Sex)'과 '생존여부(Survived)' 두 변수로 2차원 분할표를 만든 후 세 종류의 연관성 측도를 구해보도록 합시다!

혹시나 2-1에서 '성별(Sex)'과 '생존여부(Survived)' 외의 변수로 2차원 분할표를 만들었다면, 하단의 분할표 생성 코드를 각주 제거하여 실행시킨 후 진행해 주세요!
```{r}
#t_2 <- table(data$Sex,data$Survived)
#t_2
```


4-1) 직접 구하는 방법 
```{r}
#실행
#해당 과정은 분할표의 각 칸을 행을 기준으로 한 조건부 확률로 변환하는 과정입니다~!
n= apply(t_2,1,sum) #행별 합계 구하기
t_2_prob = sweep(t_2,1,n,'/') 
#sweep()는 행렬에 통계량과 함수를 적용해주는 역할을 합니다!
#형식 : sweep(행렬,방향(1:행/2:열),통계량,연산함수)
t_2_prob
```

  #**4-1-1) 비율의 차이 구하기**
```{r}
t_2_prob[1,1] - t_2_prob[2,1]
```

  #**4-1-2) 상대위험도 구하기**
```{r}
t_2_prob[1,1] / t_2_prob[2,1]
```

  #**4-1-3) 오즈비 구하기**
```{r}
(t_2_prob[1,1] / t_2_prob[1,2]) / (t_2_prob[2,1] / t_2_prob[2,2])
```

4-2) 함수를 통해 한꺼번에 구하는 방법

해당 라이브러리를 설치 및 로드해주세요!
```{r}
#install.packages('epiR')
library(epiR)
```

  #**4-2-1) epi.2by2() 함수를 사용하여 분할표의 상대위험도와 오즈비를 구해보세요!
```{r}
epi.2by2(t_2_prob)
```



